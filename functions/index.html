<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Functions - C3 Documentation</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Functions";
    var mkdocs_page_input_path = "functions.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/rust.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/ebnf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/bnf.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> C3 Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="..">About C3</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Installing</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../setup/">Setup</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../firstproject/">Your first project</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../primer/">A quick primer on C3</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../allfeatures/">Feature list</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Documentation</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="../changesfromc/">Changes from C</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../compare/">Comparisons with other languages</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../examples/">Examples</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../faq/">FAQ</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../modules/">Modules</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../types/">Types</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../define/">Define</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../arrays/">Arrays</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../vectors/">Vectors</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">Functions</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#regular-functions">Regular functions</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#function-arguments">Function arguments</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#varargs">Varargs</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#functions-and-optional-returns">Functions and optional returns</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#methods">Methods</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#implicit-first-parameters">Implicit first parameters</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#restrictions-on-methods">Restrictions on methods</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#contracts">Contracts</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#short-function-declaration-syntax">Short function declaration syntax</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#lambdas">Lambdas</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#static-initializer-and-finalizers">Static initializer and finalizers</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#changing-priority-of-static-initializers-and-finalizers">Changing priority of static initializers and finalizers</a>
    </li>
        </ul>
    </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../statements/">Statements</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../expressions/">Expressions</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../variables/">Variables</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../optionals/">Optionals and error handling</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../compiletime/">Compile time evaluation</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../contracts/">Contracts</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../generics/">Generics</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../macros/">Macros</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../reflection/">Reflection</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../operators/">Operator overloading</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../anyinterfaces/">Any and interfaces</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../undefinedbehaviour/">Undefined behaviour</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../conversion/">Conversions</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../precedence/">Precedence</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../builtins/">Builtins</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../libraries/">Libraries</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../standard_library/">Standard Library</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../ideas/">More ideas</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../naming/">Naming rules</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../comments/">Comments & Docs</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../attributes/">Attributes</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../asm/">Inline asm</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../cinterop/">C Interop</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../syntax/">Grammar</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../sample/">More code examples</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../specification/">Specification</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Build system</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../buildintro/">Introduction</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../project/">Project Structure</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../buildcommands/">Commands</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Development</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../contribute/">Contribute</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../changes/">Changes</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../rejectedideas/">Rejected ideas</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">C3 Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>Documentation &raquo;</li>
        
      
    
    <li>Functions</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="functions">Functions</h1>
<p>C3 has both regular functions and member functions. Member functions are functions namespaced using type names, and allows invocations using the dot syntax.</p>
<h2 id="regular-functions">Regular functions</h2>
<p>Regular functions are the same as C aside from the keyword <code>fn</code>, which is followed by the conventional C declaration of <code>&lt;return type&gt; &lt;name&gt;(&lt;parameter list&gt;)</code>.</p>
<pre><code>fn void test(int times)
{
    for (int i = 0; i &lt; times; i++)
    {
        io::printfn("Hello %d", i);
    }
}
</code></pre>
<h3 id="function-arguments">Function arguments</h3>
<p>C3 allows use of default arguments as well as named arguments. Note that
any unnamed arguments must appear before any named arguments.</p>
<pre><code>fn int test_with_default(int foo = 1)
{
    return foo;
}

fn void test()
{
    test_with_default();
    test_with_default(100);
}
</code></pre>
<p>Named arguments</p>
<pre><code>fn void test_named(int times, double data)
{
    for (int i = 0; i &lt; times; i++)
    {
        io::printf("Hello %d\n", i + data);
    }
}

fn void test()
{
    // Named only
    test_named(.data = 3.0, .times = 1);

    // Unnamed only
    test_named(3, 4.0);

    // Mixing named and unnamed        
    test_named(15, .data = 3.141592);
}
</code></pre>
<p>Named arguments with defaults:</p>
<pre><code>fn void test_named_default(int times = 1, double data = 3.0, bool dummy = false)
{
    for (int i = 0; i &lt; times; i++)
    {
        io::printfn("Hello %f", i + data);
    }
}

fn void test()
{
    // Named only
    test_named_default(.data = 3.5, .times = 10);

    // Unnamed and named
    test_named_default(3, .dummy = false);

    // Overwriting an unnamed argument with named is an error:
    // test_named_default(2, .times = 3); ERROR!

    // Unnamed may not follow named arguments.
    // test_named_default(.times = 3, 4.0); ERROR!
}
</code></pre>
<h4 id="varargs">Varargs</h4>
<p>There are four types of varargs: </p>
<ol>
<li>single typed</li>
<li>explicitly typed any: pass non-any arguments as references</li>
<li>implicitly typed any: arguments are implicitly converted to references (use with care)</li>
<li>untyped C-style</li>
</ol>
<p>Examples:</p>
<pre><code>fn void va_singletyped(int... args)
{
    /* args has type int[] */
}

fn void va_variants_explicit(any*... args)
{
    /* args has type any*[] */
}

fn void va_variants_implicit(args...)
{
    /* args has type any*[] */
}

extern fn void va_untyped(...); // only used for extern C functions

fn void test()
{
    va_singletyped(1, 2, 3);

    int x = 1;
    any* v = &amp;x;
    va_variants_explicit(&amp;&amp;1, &amp;x, v); // pass references for non-any arguments

    va_variants_implicit(1, x, "foo"); // arguments are implicitly converted to anys

    va_untyped(1, x, "foo"); // extern C-function
}
</code></pre>
<h3 id="functions-and-optional-returns">Functions and optional returns</h3>
<p>The return parameter may be an <em>optional result type</em> – a type suffixed by <code>!</code> indicating that this 
function might either return a regular value or an <em>optional result value</em>.</p>
<p>The below example might return optional values from both the <code>SomeError</code> optional enum as well as 
the <code>OtherResult</code> type.</p>
<pre><code>fn double! testError()
{
    double val = random_value();
    if (val &gt;= 0.2) return SomeError.BAD_JOSS_ERROR?;
    if (val &gt; 0.5) return OtherError.BAD_LUCK_ERROR?;
    return val;
}
</code></pre>
<p><em>A function call</em> which is passed one or more <em>optional result type</em> arguments will only execute 
if all optional values contain <em>expected results</em>, otherwise <em>the first</em> <em>optional result value</em> is returned.</p>
<pre><code>fn void test()
{
    // The following line is either prints a value less than 0.2
    // or does not print at all:
    io::printf("%d\n", testError());

    double x = (testError() + testError()) else 100;

    // This prints either a value less than 0.4 or 100:
    io::printf("%d\n", x);
}
</code></pre>
<p>This allows us to chain functions:</p>
<pre><code>fn void printInputWithExplicitChecks()
{
    string! line = readLine();
    if (try line)
    {
        // line is a regular "string" here.
        int! val = atoi(line);
        if (try val)
        {
            io::printf("You typed the number %d\n", val);
            return;
        }
    }
    io::printf("You didn't type an integer :(\n");    
}

fn void printInputWithChaining()
{
    if (try int val = atoi(readLine()))
    {
        io::printf("You typed the number %d\n", val);
        return;
    }
    io::printf("You didn't type an integer :(\n");    
}
</code></pre>
<h2 id="methods">Methods</h2>
<p>Methods look exactly like functions, but are prefixed with the type name and is (usually) 
invoked using dot syntax:</p>
<pre><code>struct Point
{
    int x;
    int y;
}

fn void Point.add(Point* p, int x) 
{
    p.x = x;
}

fn void example() 
{
    Point p = { 1, 2 }

    // with struct-functions
    p.add(10);

    // Also callable as:
    Point.add(&amp;p, 10);
}
</code></pre>
<p>The target object may be passed by value or by pointer:</p>
<pre><code>enum State
{
    STOPPED,
    RUNNING
}

fn bool State.mayOpen(State state) 
{
    switch (state)
    {
        case STOPPED: return true;
        case RUNNING: return false;
    }
}
</code></pre>
<h3 id="implicit-first-parameters">Implicit first parameters</h3>
<p>Because the type of the first method is known, it may be left out. To indicate a pointer <code>&amp;</code> is used.</p>
<pre><code>fn int Foo.test(&amp;self) { ... }
// equivalent to
fn int Foo.test(Foo* self) { ... }

fn int Bar.test(self) { ... }
// equivalent to
fn int Bar.test(Bar self) { ... }
</code></pre>
<p>It is customary to use <code>self</code> as the name of the first parameter, but it is not required.</p>
<h3 id="restrictions-on-methods">Restrictions on methods</h3>
<ul>
<li>Methods on a struct/union may not have the same name as a member.</li>
<li>Methods only works on distinct, struct, union and enum types.</li>
<li>When taking a function pointer of a method, use the full name.</li>
<li>Using subtypes, overlapping function names will be shadowed.</li>
</ul>
<h2 id="contracts">Contracts</h2>
<p>C3's error handling is not intended to use errors to signal invalid data or to check invariants and post conditions. Instead C3's approach is to add annotations to the function, that conditionally will be compiled into asserts.</p>
<p>As an example, the following code:</p>
<pre><code>/**
 * @param foo : the number of foos 
 * @require foo &gt; 0, foo &lt; 1000
 * @return number of foos x 10
 * @ensure return &lt; 10000, return &gt; 0
 **/
fn int testFoo(int foo)
{
    return foo * 10;
}
</code></pre>
<p>Will in debug builds be compiled into something like this:</p>
<pre><code>fn int testFoo(int foo)
{
    assert(foo &gt; 0);
    assert(foo &lt; 1000);
    int _return = foo * 10;
    assert(_return &lt; 10000);
    assert(_return &gt; 0);
    return _return;
}
</code></pre>
<p>The compiler is allowed to use the contracts for optimizations. For example this:</p>
<pre><code>fn int testExample(int bar)
{
    if (testFoo(bar) == 0) return -1;
    return 1;
}
</code></pre>
<p>May be optimized to:</p>
<pre><code>fn int testExample(int bar)
{
    return 1;
}
</code></pre>
<p>In this case the compiler can look at the post condition of <code>result &gt; 0</code> to determine that <code>testFoo(foo) == 0</code> must always be false.</p>
<p>Looking closely at this code, we not that nothing guarantees that <code>bar</code> is not violating the preconditions. In Safe builds this will usually be checked in runtime, but a sufficiently smart compiler will warn about the lack of checks on <code>bar</code>. Execution of code violating pre and post conditions has unspecified behaviour.</p>
<h2 id="short-function-declaration-syntax">Short function declaration syntax</h2>
<p>For very short functions, C3 offers a "short declaration" syntax using <code>=&gt;</code>:</p>
<pre><code>// Regular
fn int square(int x)
{
    return x * x;
}
// Short
fn int square_short(int x) =&gt; x * x;
</code></pre>
<h2 id="lambdas">Lambdas</h2>
<p>It's possible to create anonymous functions using the regular <code>fn</code> syntax. Anonymous 
functions are identical to regular functions and do not capture variables from the 
surrounding scope:</p>
<pre><code>def IntTransform = fn int(int);

fn void apply(int[] arr, IntTransform t)
{
    foreach (&amp;i : arr) *i = t(*i);
}

fn void main()
{
    int[] x = { 1, 2, 5 };
    // Short syntax with inference:
    apply(x, fn (i) =&gt; i * i);
    // Regular syntax without inference: 
    // apply(x, fn int(int i) { return i * i; });
    // Prints [1, 4, 25]
    io::printfn("%s", x);        
}
</code></pre>
<h2 id="static-initializer-and-finalizers">Static initializer and finalizers</h2>
<p>It is sometimes useful to run code at startup and shutdown. Static initializers and finalizers
are regular functions annotated with <code>@init</code> and <code>@finalizer</code> that are run at startup and shutdown respectively:</p>
<pre><code>fn void run_at_startup() @init
{
    // Run at startup
    some_function.init(512);
}

fn void run_at_shutdown() @finalizer
{
    some_thing.shutdown();
}
</code></pre>
<p>Note that invoking <code>@finalizer</code> is an best effort attempt by the OS and may not
be called during abnormal shutdown.</p>
<h3 id="changing-priority-of-static-initializers-and-finalizers">Changing priority of static initializers and finalizers</h3>
<p>It is possible to provide an argument to the attributes to set the actual priority. It is recommended
that programs use a priority of 1024 or higher. The higher the value, the later it
will be called. The lowest priority is 65535.</p>
<pre><code>// Print "Hello World" at startup.

fn void start_world() @init(3000)
{
    io::printn("World");
}
fn void start_hello() @init(2000)
{
    io::print("Hello ");
}
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../statements/" class="btn btn-neutral float-right" title="Statements">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../vectors/" class="btn btn-neutral" title="Vectors"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../vectors/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../statements/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
