<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Arrays - C3 Documentation</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Arrays";
    var mkdocs_page_input_path = "arrays.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/rust.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/ebnf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/bnf.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> C3 Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="..">About C3</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Installing</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../setup/">Setup</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../firstproject/">Your first project</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../primer/">A quick primer on C3</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../allfeatures/">Feature list</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Documentation</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="../changesfromc/">Changes from C</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../compare/">Comparisons with other languages</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../examples/">Examples</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../modules/">Modules</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../types/">Types</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../define/">Define</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">Arrays</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#fixed-arrays">Fixed arrays</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#subarray">Subarray</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#slicing-arrays">Slicing arrays</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#conversion-list">Conversion list</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#internals">Internals</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#iteration-over-arrays">Iteration over arrays</a>
    </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../functions/">Functions</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../statements/">Statements</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../expressions/">Expressions</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../variables/">Variables</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../optionals/">Optionals and error handling</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../compiletime/">Compile time evaluation</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../contracts/">Contracts</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../generics/">Generics</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../macros/">Macros</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../reflection/">Reflection</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../operators/">Operator overloading</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../anyinterfaces/">Any and protocols</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../undefinedbehaviour/">Undefined behaviour</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../conversion/">Conversions</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../precedence/">Precedence</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../builtins/">Builtins</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../libraries/">Libraries</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../standard_library/">Standard Library</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../ideas/">More ideas</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../naming/">Naming rules</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../comments/">Comments & Docs</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../attributes/">Attributes</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../asm/">Inline asm</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../cinterop/">C Interop</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../syntax/">Grammar</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../sample/">More code examples</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../specification/">Specification</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Build system</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../buildintro/">Introduction</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../project/">Project Structure</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../buildcommands/">Commands</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Development</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../contribute/">Contribute</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../changes/">Changes</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../rejectedideas/">Rejected ideas</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">C3 Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>Documentation &raquo;</li>
        
      
    
    <li>Arrays</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="arrays">Arrays</h1>
<p>Arrays has a central role in programming. C3 offers 2 built-in types of arrays:</p>
<h2 id="fixed-arrays">Fixed arrays</h2>
<p><code>&lt;type&gt;[&lt;size&gt;]</code> e.g. <code>int[4]</code>. These are treated as values and will be copied if given as parameter. Unlike C, the number is part of its type. Taking a pointer to a fixed array will create a pointer to a fixed array, e.g. <code>int[4]*</code>. </p>
<p>Unlike C, fixed arrays do not decay into pointers, instead an <code>int[4]*</code> may be implicitly converted into an <code>int*</code>.</p>
<pre><code>// C
int foo(int *a) { ... }

int x[3] = { 1, 2, 3 };
foo(x);

// C3
fn int foo(int *a) { ... }

int x[3] = { 1, 2, 3 };
foo(&amp;x);
</code></pre>
<p>When you want to initialize a fixed array without specifying the size, use the [*] array syntax:</p>
<pre><code>int[3] a = { 1, 2, 3 };
int[*] b = { 4, 5, 6 }; // Type inferred to be int[3]
</code></pre>
<h2 id="subarray">Subarray</h2>
<p>The final type is the subarray <code>&lt;type&gt;[]</code>  e.g. <code>int[]</code>. A subarray is a view into either a fixed or variable array. Internally it is represented as a struct containing a pointer and a size. Both fixed and variable arrays may be converted into slices, and slices may be implicitly converted to pointers:</p>
<pre><code>int[4] a = { 1, 2, 3, 4};
int[] b = &amp;a; // Implicit conversion is always ok.
int[4] c = (int[4])b; // Will copy the value of b into c.
int[4]* d = (int[4])a; // Equivalent to d = &amp;a
b.len; // Returns 4
e += 1;
int* f = b; // Equivalent to e = &amp;a
f = d; // implicit conversion ok.
</code></pre>
<h3 id="slicing-arrays">Slicing arrays</h3>
<p>It's possible to use a range syntax to create subarrays from pointers, arrays, vararrays and other subarrays. They either use range syntax:
<code>arr[&lt;start index&gt;..&lt;end index&gt;]</code> (the end index is included in the final result) or start + len syntax: <code>arr[&lt;start index&gt; : len]</code></p>
<pre><code>int[5] a = { 1, 20, 50, 100, 200 };
int[] b = a[0..4]; // The whole array as a slice.
int[] b2 = a[0:5]; // Same as above.
int[] c = a[2..3]; // { 50, 100 }
int[] c2 = a[2:2]; // Same as above.
</code></pre>
<p>It's possible to omit the first and last index in ranges, and the start index for start + len.
Omitting the start index will default it to 0, omitting the end index will set it to the last valid
index (this is not allowed on pointers). Length cannot be omitted in start + len syntax.</p>
<p>The following are all equivalent:</p>
<pre><code>int[5] a = { 1, 20, 50, 100, 200 };
int[] b = a[0..4];
int[] c = a[..4];
int[] d = a[0..];
int[] e = a[..];
int[] f = a[0:5];
int[] g = a[:5];
</code></pre>
<p>One may also slice from the end. Again this is not allowed for pointers.</p>
<pre><code>int[5] a = { 1, 20, 50, 100, 200 };
int[] b = a[1..^2]; // { 20, 50, 100 }
int[] c = a[^3..]; // { 50, 100, 200 }
int[] d = a[^3:2]; // { 50, 100 }
</code></pre>
<p>One may also use assign to slices:</p>
<pre><code>int[3] a = { 1, 20, 50 };
a[1..2] = 0; // a = { 1, 0, 0}
</code></pre>
<p>Or copy slices to slices:</p>
<pre><code>int[3] a = { 1, 20, 50 };
int[3] b = { 2, 4, 5 }
a[1..2] = b[0..1]; // a = { 1, 2, 4}
</code></pre>
<p>Copying overlapping ranges, e.g. <code>a[1..2] = a[0..1]</code> is undefined behaviour.</p>
<h3 id="conversion-list">Conversion list</h3>
<table>
<thead>
<tr>
<th align="center"></th>
<th align="center">int[4]</th>
<th align="center">int[]</th>
<th align="center">int[4]*</th>
<th align="center">int*</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">int[4]</td>
<td align="center">copy</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">int[]</td>
<td align="center">-</td>
<td align="center">assign</td>
<td align="center">assign</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">int[4]*</td>
<td align="center">-</td>
<td align="center">cast</td>
<td align="center">assign</td>
<td align="center">cast</td>
</tr>
<tr>
<td align="center">int*</td>
<td align="center">-</td>
<td align="center">assign</td>
<td align="center">assign</td>
<td align="center">assign</td>
</tr>
</tbody>
</table>
<p>Note that all casts above are inherently unsafe and will only work if the type cast is indeed compatible.</p>
<p>For example:</p>
<pre><code>int[4] a;
int[4]* b = &amp;a;
int* c = b;
// Safe cast:
int[4]* d = (int[4]*)c; 
int e = 12;
int* f = &amp;e;
// Incorrect, but not checked
int[4]* g = (int[4]*)f;
// Also incorrect but not checked.
int[] h = f[0..2];
</code></pre>
<h4 id="internals">Internals</h4>
<p>Internally the layout of a slice is guaranteed to be <code>struct { &lt;type&gt;* ptr; usz len; }</code>.</p>
<p>There is a built-in struct <code>std::core::runtime::SubArrayContainer</code> which has the exact data layout of the fat array pointers. It is defined to be</p>
<pre><code>struct SubArrayContainer
{
    void* ptr;
    usz len;
}
</code></pre>
<h2 id="iteration-over-arrays">Iteration over arrays</h2>
<p>Slices, fixed and variable arrays may all be iterated over using <code>foreach (Type x : array)</code>:</p>
<pre><code>int[4] a = { 1, 2, 3, 5 };
foreach (int x : a)
{
    ...
}
</code></pre>
<p>Using <code>&amp;</code> it is possible to get an element by reference rather than by copy.
Furthermore, by providing two variable name, the first is assumed to be the
index:</p>
<pre><code>Foo[4] a = { ... }
foreach (int idx, Foo* &amp;f : a)
{
    f.abc = idx; // Mutates the array element
}
</code></pre>
<p>It is possible to enable foreach on any type 
by implementing "len" and "[]" methods and annotating them using the <code>@operator</code> attribute:</p>
<pre><code>struct Vector
{
    usz size;
    int* elements;
}

macro int Vector.get(Vector* vector, usz element) @operator([])
{
    return vector.elements[element];
}

macro usz Vector.size(Vector* vector) @operator(len)
{
    return vector.size;
}

Vector v;
v.add(3);
v.add(7);

// Will print 3 and 7
foreach (int i : v)
{
    io::printfn("%d", i);
}
</code></pre>
<p>For more information, see <a href="../operators">operator overloading</a></p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../functions/" class="btn btn-neutral float-right" title="Functions">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../define/" class="btn btn-neutral" title="Define"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../define/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../functions/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
